{"code":"import { animationFrameScheduler, interval, fromEvent } from \"rxjs\";\r\nimport { map } from 'rxjs/operators';\r\nvar Engine = (function () {\r\n    function Engine(canvas, ctx) {\r\n        var _this = this;\r\n        this.canvas = canvas;\r\n        this.ctx = ctx;\r\n        this.frame = interval(0, animationFrameScheduler);\r\n        this.onMove = fromEvent(document, 'mousemove');\r\n        this.onClick = fromEvent(document, 'click');\r\n        this.mousePos = new Vector2({ x: 0, y: 0 });\r\n        this.gameObjects = [];\r\n        this.resize();\r\n        this.frame.subscribe(this.physics.bind(this));\r\n        this.frame.subscribe(this.draw.bind(this));\r\n        this.onMove.pipe(map(function (e) { return _this.getMousePos.bind(_this)(e); })).subscribe(function (p) { return _this.mousePos = p; });\r\n        this.onClick.subscribe(function (e) { return _this.gameObjects.filter(function (g) { return !!g.onClick; }).forEach(function (g) { return g.onClick(g); }); });\r\n    }\r\n    Engine.prototype.resize = function () {\r\n        this.canvas.height = this.canvas.clientHeight;\r\n        this.canvas.width = this.canvas.clientWidth;\r\n        this.size = {\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n            halfWidth: this.canvas.width * 0.5,\r\n            halfHeight: this.canvas.height * 0.5\r\n        };\r\n        this.ctx.translate(this.size.halfWidth, this.size.halfHeight);\r\n    };\r\n    Engine.prototype.getMousePos = function (event) {\r\n        return {\r\n            x: event.clientX - this.size.halfWidth,\r\n            y: event.clientY - this.size.halfHeight\r\n        };\r\n    };\r\n    Engine.prototype.draw = function () {\r\n        this.ctx.clearRect(-this.size.halfWidth, -this.size.halfHeight, this.size.width, this.size.height);\r\n        this.gameObjects.forEach(function (obj) { return obj.render(obj); });\r\n    };\r\n    Engine.prototype.physics = function () {\r\n        this.gameObjects.forEach(function (obj) {\r\n            obj.position.x += obj.velocity.x;\r\n            obj.position.y += obj.velocity.y;\r\n            obj.physics(obj);\r\n        });\r\n    };\r\n    Engine.prototype.collisionDetection = function (obj) {\r\n        var physicsObjects = this.gameObjects.filter(function (g) { return !!g.boundingBox; });\r\n        for (var i = 0; i < physicsObjects.length; i++) {\r\n            var colObj = physicsObjects[i];\r\n            if (colObj != obj) {\r\n                var a = {\r\n                    left: obj.position.x - obj.boundingBox.width * 0.5,\r\n                    right: obj.position.x + obj.boundingBox.width * 0.5,\r\n                    bottom: obj.position.y - obj.boundingBox.height * 0.5,\r\n                    top: obj.position.y + obj.boundingBox.height * 0.5,\r\n                };\r\n                var b = {\r\n                    left: colObj.position.x - colObj.boundingBox.width * 0.5,\r\n                    right: colObj.position.x + colObj.boundingBox.width * 0.5,\r\n                    bottom: colObj.position.y - colObj.boundingBox.height * 0.5,\r\n                    top: colObj.position.y + colObj.boundingBox.height * 0.5,\r\n                };\r\n                var hits = {\r\n                    left: (b.left > a.right),\r\n                    right: (b.right < a.left),\r\n                    top: (b.top < a.bottom),\r\n                    bottom: (b.bottom > a.top),\r\n                };\r\n                if (!(hits.left || hits.right || hits.top || hits.bottom)) {\r\n                    var colHits = {\r\n                        left: a.left > b.right,\r\n                        right: a.right < b.left,\r\n                        top: a.top < b.bottom,\r\n                        bottom: a.bottom > b.top,\r\n                    };\r\n                    var hit = new CollisionHit({\r\n                        collider: obj,\r\n                        collidi: colObj,\r\n                        colliderHits: hits,\r\n                        collidiHits: colHits\r\n                    });\r\n                    colObj.onCollision.bind(this)(hit);\r\n                    obj.onCollision.bind(this)(hit);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return Engine;\r\n}());\r\nexport { Engine };\r\nexport function lerp(start, end, interval) {\r\n    if (interval > 1) {\r\n        throw new Error('Interval must be less than 1!');\r\n    }\r\n    var nLerp = function (s, e, i) {\r\n        return (1 - i) * s + i * e;\r\n    };\r\n    return new Vector2({ x: nLerp(start.x, end.x, interval), y: nLerp(start.y, end.y, interval) });\r\n}\r\nvar BoxHits = (function () {\r\n    function BoxHits(args) {\r\n        if (args === void 0) { args = {}; }\r\n        this.left = false;\r\n        this.right = false;\r\n        this.bottom = false;\r\n        this.top = false;\r\n        Object.assign(this, args);\r\n    }\r\n    return BoxHits;\r\n}());\r\nexport { BoxHits };\r\nvar CollisionHit = (function () {\r\n    function CollisionHit(args) {\r\n        Object.assign(this, args);\r\n    }\r\n    return CollisionHit;\r\n}());\r\nexport { CollisionHit };\r\nvar Vector2 = (function () {\r\n    function Vector2(args) {\r\n        Object.assign(this, args);\r\n    }\r\n    return Vector2;\r\n}());\r\nexport { Vector2 };\r\nvar Rect = (function () {\r\n    function Rect(args) {\r\n        Object.assign(this, args);\r\n    }\r\n    Object.defineProperty(Rect.prototype, \"mesh\", {\r\n        get: function () {\r\n            var halfWidth = this.width * 0.5;\r\n            var halfHeight = this.height * 0.5;\r\n            return [\r\n                { x: halfWidth, y: halfHeight },\r\n                { x: halfWidth, y: -halfHeight },\r\n                { x: -halfWidth, y: -halfHeight },\r\n                { x: -halfWidth, y: halfHeight },\r\n                { x: halfWidth, y: halfHeight },\r\n            ];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Rect;\r\n}());\r\nexport { Rect };\r\nvar GameObject = (function () {\r\n    function GameObject() {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this.props = {};\r\n        this.physics = function () { };\r\n        this.onCollision = function () { };\r\n        Object.assign.apply(Object, [this].concat(args));\r\n        if (!!this.init) {\r\n            this.init(this);\r\n        }\r\n        this.render.bind(this);\r\n    }\r\n    GameObject.prototype.drawBoundingBox = function (ctx) {\r\n        var _this = this;\r\n        var mesh = this.boundingBox.mesh;\r\n        ctx.beginPath();\r\n        ctx.moveTo(mesh[0].x + this.position.x, mesh[0].y + this.position.y);\r\n        ctx.strokeStyle = '#67fc7b';\r\n        mesh.forEach(function (m) {\r\n            ctx.lineTo(m.x + _this.position.x, m.y + _this.position.y);\r\n        });\r\n        ctx.closePath();\r\n        ctx.stroke();\r\n    };\r\n    return GameObject;\r\n}());\r\nexport { GameObject };\r\n//# sourceMappingURL=engine.js.map","map":{"version":3,"file":"engine.js","sourceRoot":"","sources":["src/engine.ts"],"names":[],"mappings":"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"}}
